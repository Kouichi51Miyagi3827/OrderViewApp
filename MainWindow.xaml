<Window x:Class="OrderViewApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:OrderViewApp"
        xmlns:models="clr-namespace:OrderViewApp.Models"
        xmlns:converters="clr-namespace:OrderViewApp.Converters"
        mc:Ignorable="d"
        Title="準備商品一覧" Height="800" Width="1400"
        WindowState="Maximized" WindowStartupLocation="CenterScreen">
    
    <DockPanel>
        <DockPanel.Resources>
            <!-- BooleanToVisibilityConverter -->
            <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
            
            <!-- PeriodFilterTypeConverter -->
            <converters:PeriodFilterTypeConverter x:Key="PeriodFilterTypeConverter"/>
            
            <!-- DisplayModeTypeConverter -->
            <converters:DisplayModeTypeConverter x:Key="DisplayModeTypeConverter"/>
            
            <!-- ReceptionNumberToBackgroundColorConverter -->
            <converters:ReceptionNumberToBackgroundColorConverter x:Key="ReceptionNumberToBackgroundColorConverter"/>
            
            <!-- BackgroundColorConverter -->
            <converters:BackgroundColorConverter x:Key="BackgroundColorConverter"/>
            
            <!-- 受付番号に応じた行の背景色スタイル定義 -->
            <Style TargetType="DataGridRow">
                <Setter Property="Foreground" Value="Black"/>
                <Setter Property="Background">
                    <Setter.Value>
                        <MultiBinding Converter="{StaticResource BackgroundColorConverter}">
                            <Binding Path="GroupColorIndex"/>
                            <Binding Path="DataContext.IsBackgroundColorEnabled" RelativeSource="{RelativeSource AncestorType=Window}"/>
                            <Binding Path="(ItemsControl.AlternationIndex)" RelativeSource="{RelativeSource AncestorType=DataGridRow}"/>
                        </MultiBinding>
                    </Setter.Value>
                </Setter>
            </Style>
        </DockPanel.Resources>

        <!-- ヘッダー領域 (上部に配置) -->
        <Border DockPanel.Dock="Top" Background="#F0F0F0" BorderBrush="#CCCCCC" BorderThickness="0,0,0,1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="40"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- タイトル行 -->
                <TextBlock Grid.Row="0"
                           Text="準備商品 リアルタイム可視化システム" 
                           VerticalAlignment="Center" 
                           Margin="15,0" 
                           FontSize="18" 
                           FontWeight="Bold"
                           Foreground="#333333"/>
                
                <!-- 期間フィルター行 -->
                <StackPanel Grid.Row="1" 
                            Orientation="Horizontal" 
                            Margin="15,5,15,5">
                    <TextBlock Text="期間:" 
                               VerticalAlignment="Center" 
                               Margin="0,0,10,0"
                               FontSize="14"/>
                    <ComboBox x:Name="PeriodFilterComboBox"
                              SelectedItem="{Binding SelectedPeriodFilter}"
                              Width="150"
                              Margin="0,0,20,0">
                        <ComboBox.ItemsSource>
                            <x:Array Type="{x:Type models:PeriodFilterType}">
                                <models:PeriodFilterType>Today</models:PeriodFilterType>
                                <models:PeriodFilterType>TodayAndTomorrow</models:PeriodFilterType>
                                <models:PeriodFilterType>Tomorrow</models:PeriodFilterType>
                                <models:PeriodFilterType>Custom</models:PeriodFilterType>
                            </x:Array>
                        </ComboBox.ItemsSource>
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Converter={StaticResource PeriodFilterTypeConverter}}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    
                    <!-- カスタム期間のDatePicker（カスタム期間選択時のみ表示） -->
                    <StackPanel Orientation="Horizontal" 
                                Visibility="{Binding IsCustomPeriodVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="開始日:" 
                                   VerticalAlignment="Center" 
                                   Margin="0,0,5,0"
                                   FontSize="15"/>
                        <DatePicker SelectedDate="{Binding CustomStartDate}"
                                    Width="150"
                                    Margin="0,0,20,0"/>
                        <TextBlock Text="終了日:" 
                                   VerticalAlignment="Center" 
                                   Margin="0,0,5,0"
                                   FontSize="15"/>
                        <DatePicker SelectedDate="{Binding CustomEndDate}"
                                    Width="150"/>
                    </StackPanel>
                    
                    <!-- 表示モードフィルター -->
                    <TextBlock Text="表示モード:" 
                               VerticalAlignment="Center" 
                               Margin="20,0,10,0"
                               FontSize="15"/>
                    <ComboBox x:Name="DisplayModeComboBox"
                              SelectedItem="{Binding SelectedDisplayMode}"
                              Width="150"
                              Margin="0,0,10,0">
                        <ComboBox.ItemsSource>
                            <x:Array Type="{x:Type models:DisplayModeType}">
                                <models:DisplayModeType>Incomplete</models:DisplayModeType>
                                <models:DisplayModeType>All</models:DisplayModeType>
                                <models:DisplayModeType>Completed</models:DisplayModeType>
                            </x:Array>
                        </ComboBox.ItemsSource>
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Converter={StaticResource DisplayModeTypeConverter}}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    
                    <!-- 背景色チェックボックス -->
                    <CheckBox Content="背景色"
                              IsChecked="{Binding IsBackgroundColorEnabled}"
                              VerticalAlignment="Center"
                              Margin="20,0,10,0"
                              FontSize="15"/>
                    
                    <!-- リロードボタン -->
                    <Button Command="{Binding ReloadCommand}"
                            Content="🔃"
                            FontSize="16"
                            Width="40"
                            Height="30"
                            VerticalAlignment="Center"
                            ToolTip="最新のデータを読み込む"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- メインの表を表示する領域 (残りの全領域を埋める) -->
        <Grid Margin="5">
            <DataGrid x:Name="OrdersGrid" 
                      AutoGenerateColumns="False" 
                      IsReadOnly="True"
                      ItemsSource="{Binding Orders}"
                      FontSize="16"
                      GridLinesVisibility="All"
                      HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Auto"
                      RowHeaderWidth="0"
                      AlternationCount="2">
                
                <DataGrid.Columns>
                    <!-- ご指定の順番でカラムを定義 -->
                    <DataGridTextColumn Header="商品名" Binding="{Binding ProductName}" Width="2.5*"/>
                    <DataGridTextColumn Header="数" Binding="{Binding Quantity}" Width="0.3*"/>
                    <DataGridTextColumn Header="摘要" Binding="{Binding Detail}" Width="2*"/>
                    <DataGridTextColumn Header="期日" Binding="{Binding DueDate, StringFormat='MM/dd'}" Width="0.6*"/>
                    <DataGridTextColumn Header="期限" Binding="{Binding ExpiryDate}" Width="1.2*"/>
                    <DataGridTextColumn Header="期限2" Binding="{Binding ExpiryDate2}" Width="0.6*"/>
                    <DataGridTextColumn Header="用件" Binding="{Binding Requirements}" Width="1*"/>
                    <DataGridTextColumn Header="顧客名" Binding="{Binding CustomerName}" Width="2.5*"/>
                    <DataGridTextColumn Header="在庫(OK)" Binding="{Binding StockOK}" Width="*"/>
                    <DataGridTextColumn Header="在庫(清掃中)" Binding="{Binding StockCleaning}" Width="*"/>
                </DataGrid.Columns>
                
            </DataGrid>
        </Grid>
        
    </DockPanel>
</Window>